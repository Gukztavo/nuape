<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NAI/NUAPE - Sistema Acadêmico</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>NAI/NUAPE - Sistema Acadêmico</h1>

      <table class="table table-bordered mt-4">
        <thead>
          <tr>
            <th>RA</th>
            <th>Nome do Aluno</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1234</td>
            <td>Fulano da Silva</td>
            <td>
              <button
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#peiModal"
                onclick="loadModalData('1234', 'Fulano da Silva')"
              >
                Visualizar PEI
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div
      class="modal fade"
      id="peiModal"
      tabindex="-1"
      aria-labelledby="peiModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="peiModalLabel">Detalhes do PEI</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <iframe
              id="peiIframe"
              src=""
              width="100%"
              height="200"
              frameborder="0"
            ></iframe>
            <form id="peiForm" class="mt-3">
              <div class="mb-3">
                <label for="professorName" class="form-label"
                  >Nome do Professor</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="professorName"
                  placeholder="Nome ou login do professor (@professores.utfpr.edu.br)"
                  required
                />
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="peiEmailReceived"
                  required
                />
                <label class="form-check-label" for="peiEmailReceived">
                  Recebi o PEI por e-mail da coordenação
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="peiAcknowledged"
                  required
                />
                <label class="form-check-label" for="peiAcknowledged">
                  Li e estou ciente do PEI
                </label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
            <button type="button" class="btn btn-primary" onclick="saveData()">
              Salvar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function loadModalData(ra, aluno) {
        const iframe = document.getElementById("peiIframe");
        iframe.src = `https://utfpr.edu.br/pei?ra=${ra}&aluno=${encodeURIComponent(
          aluno
        )}`;

        document.getElementById("peiForm").setAttribute("data-ra", ra);
        document.getElementById("peiForm").setAttribute("data-aluno", aluno);
      }

      function saveData() {
        const form = document.getElementById("peiForm");
        const ra = form.getAttribute("data-ra");
        const aluno = form.getAttribute("data-aluno");
        const professor = document.getElementById("professorName").value;
        const emailReceived =
          document.getElementById("peiEmailReceived").checked;
        const acknowledged = document.getElementById("peiAcknowledged").checked;
        const date = new Date().toISOString();

        if (!emailReceived || !acknowledged) {
          alert("Você deve confirmar ambas as opções.");
          return;
        }

        console.log("Salvando os dados:", {
          ra,
          aluno,
          professor,
          emailReceived,
          acknowledged,
          date,
        });

        alert("Dados salvos com sucesso!");
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("peiModal")
        );
        modal.hide();
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
